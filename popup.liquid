<!-- Archivo: popup.liquid -->
<!-- Fecha: 2025-03-06 -->
<!-- Autor: JhonyAlex -->

<div id="popup-container">
  <div id="popup-overlay"></div>
  <div id="popup">
    <span class="close-x">&times;</span>
    <div class="popup-step" id="popup-step-1">
      <div class="popup-content">
        <div class="popup-column">
          <h2>¬°Descubre tu Sorpresa Especial!</h2>
          <p>
            D√©janos tu correo electr√≥nico y obt√©n un regalo exclusivo que hemos preparado solo para ti. <br>
            <strong>¬°No te lo pierdas!</strong>
          </p>
          <div id="mc_embed_shell">
            <link href="//cdn-images.mailchimp.com/embedcode/classic-061523.css" rel="stylesheet" type="text/css">
            <div id="mc_embed_signup">
              <form
                action="https://shalombonic.us15.list-manage.com/subscribe/post?u=2f5bf3db341301717bbd5a789&amp;id=91c9e265c7&amp;f_id=00047ae0f0"
                method="post"
                id="mc-embedded-subscribe-form"
                name="mc-embedded-subscribe-form"
                class="validate"
                target="_blank"
                novalidate="novalidate"
              >
                <div id="mc_embed_signup_scroll">
                  <div class="mc-field-group">
                    <label for="mce-EMAIL">Direcci√≥n de correo electr√≥nico <span class="asterisk">*</span></label>
                    <input
                      type="email"
                      name="EMAIL"
                      class="required email"
                      id="mce-EMAIL"
                      required=""
                      value=""
                      placeholder="Tu correo electr√≥nico"
                    >
                  </div>
                  <div class="mc-field-group">
                    <label for="mce-FNAME">Nombre <span class="asterisk">*</span></label>
                    <input
                      type="text"
                      name="FNAME"
                      class="required"
                      id="mce-FNAME"
                      required=""
                      value=""
                      placeholder="Tu nombre"
                    >
                  </div>
                  <div class="mc-field-group">
                    <label for="mce-LNAME">Apellido <span class="asterisk">*</span></label>
                    <input
                      type="text"
                      name="LNAME"
                      class="required"
                      id="mce-LNAME"
                      required=""
                      value=""
                      placeholder="Tu apellido"
                    >
                  </div>
                  <div class="mc-field-group">
                    <label for="mce-PHONE">Tel√©fono <span class="asterisk">*</span></label>
                    <input
                      type="tel"
                      name="PHONE"
                      class="required"
                      id="mce-PHONE"
                      required=""
                      value=""
                      placeholder="Tu n√∫mero de tel√©fono"
                    >
                  </div>
                  <div id="mce-responses" class="clear">
                    <div class="response" id="mce-error-response" style="display: none;"></div>
                    <div class="response" id="mce-success-response" style="display: none;"></div>
                  </div>
                  <div aria-hidden="true" style="position: absolute; left: -5000px;">
                    <input type="text" name="b_2f5bf3db341301717bbd5a789_91c9e265c7" tabindex="-1" value="">
                  </div>
                  <div class="clear">
                    <input
                      type="submit"
                      name="subscribe"
                      id="mc-embedded-subscribe"
                      class="button"
                      value="¬°Quiero mi regalo!"
                    >
                  </div>
                </div>
              </form>
            </div>
            <script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script>
            <script type="text/javascript">
              (function($) {
                window.fnames = new Array();
                window.ftypes = new Array();
                fnames[0]='EMAIL';
                ftypes[0]='email';
                fnames[1]='FNAME';
                ftypes[1]='text';
                fnames[2]='LNAME';
                ftypes[2]='text';
                fnames[3]='ADDRESS';
                ftypes[3]='address';
                fnames[4]='PHONE';
                ftypes[4]='phone';
                fnames[5]='BIRTHDAY';
                ftypes[5]='birthday';
                fnames[6]='COMPANY';
                ftypes[6]='text';
              }(jQuery));
              var $mcj = jQuery.noConflict(true);
            </script>
          </div>
        </div>
        <div class="popup-column">
          <img
            src="https://cdn.shopify.com/s/files/1/0714/6962/9761/files/Odeta4.webp?v=1729716210"
            alt="Imagen de regalo"
            class="img-fluid"
          >
        </div>
      </div>
    </div>
    <div class="popup-step" id="popup-step-2" style="display: none;">
      <div class="coupon-container">
        <h2>¬°Gracias por suscribirte!</h2>
        <p>Aqu√≠ tienes tu cup√≥n de descuento del 20%:</p>
        <div class="coupon-code"><strong>PROMO20</strong></div>
        <div class="coupon-image">
          <img
            src="https://cdn.shopify.com/s/files/1/0714/6962/9761/files/1_resultado_c726077c-6372-49af-9e6f-9966004a0bbd.webp?v=1729691183"
            alt="Imagen de cup√≥n"
            class="img-fluid"
          >
        </div>
        <div class="countdown-timer" id="countdown-timer"></div>
        <button id="close-popup" class="close-button">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<!-- Versi√≥n minimizada del popup -->
<div id="minimized-popup" style="display: none;">
  <div class="gift-icon">üéÅ</div>
  <span>¬°Una sorpresa te espera aqu√≠!</span>
</div>

<style>
  .popup-step {
    display: none;
  }

  .coupon-container {
    text-align: center;
    max-width: 450px;
    margin: 0 auto;
    background-color: #f8f9fa;
    padding: 20px;
    border-radius: 0.375rem;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
  }

  .coupon-container h2 {
    color: #922858;
    margin-bottom: 15px;
    font-size: 24px;
    font-weight: 600;
  }

  .coupon-container p {
    color: #555;
    margin-bottom: 15px;
    font-size: 16px;
  }

  .coupon-code {
    background-color: #fff;
    border: 2px dashed #922858;
    padding: 15px;
    margin: 20px auto;
    max-width: 200px;
    font-size: 24px;
    color: #922858;
    border-radius: 0.375rem;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
  }

  .coupon-image {
    margin: 20px auto;
    max-width: 300px;
  }

  .coupon-image img {
    max-width: 100%;
    height: auto;
    border-radius: 0.375rem;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
  }

  .countdown-timer {
    font-size: 18px;
    color: #922858;
    margin-top: 15px;
  }

  .close-button {
    background-color: #922858;
    color: white;
    border: none;
    border-radius: 0.375rem;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.15s ease-in-out;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    margin-top: 20px;
  }

  .close-button:hover {
    background-color: #7a1e48;
    transform: translateY(-1px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
  }

  #popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: none;
    z-index: 1040;
  }

  #popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 30px;
    max-width: 800px;
    width: 90%;
    box-shadow: 0 0.5rem 1rem
</style>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const popupContainer = document.getElementById('popup-container');
    const popupOverlay = document.getElementById('popup-overlay');
    const minimizedPopup = document.getElementById('minimized-popup');

    let popupShownToday = localStorage.getItem('popupShown') && new Date() - new Date(localStorage.getItem('popupShown')) < 24 * 60 * 60 * 1000;
    let completedStepTwo = localStorage.getItem('completedStepTwo') === 'true';

    if (!popupShownToday) {
      setTimeout(() => {
        popupContainer.style.display = 'block';
        popupOverlay.style.display = 'block';
        localStorage.setItem('popupShown', new Date());
      }, 3000);
    } else if (!completedStepTwo) {
      minimizedPopup.style.display = 'flex';
    }

    document.getElementById('close-popup').addEventListener('click', () => closePopup(true));
    document.querySelector('.close-x').addEventListener('click', () => closePopup(false));
    popupOverlay.addEventListener('click', () => closePopup(false));
    minimizedPopup.addEventListener('click', () => {
      minimizedPopup.style.display = 'none';
      popupContainer.style.display = 'block';
      popupOverlay.style.display = 'block';
      if (localStorage.getItem('currentStep') === '2') {
        document.getElementById('popup-step-1').style.display = 'none';
        document.getElementById('popup-step-2').style.display = 'block';
      } else {
        document.getElementById('popup-step-1').style.display = 'block';
        document.getElementById('popup-step-2').style.display = 'none';
      }
    });

    function closePopup(completed) {
      popupContainer.style.display = 'none';
      popupOverlay.style.display = 'none';
      if (completed) {
        localStorage.setItem('completedStepTwo', 'true');
      } else {
        const currentStep = document.getElementById('popup-step-1').style.display === 'none' ? '2' : '1';
        localStorage.setItem('currentStep', currentStep);
        if (!completedStepTwo) {
          minimizedPopup.style.display = 'flex';
        }
      }
    }

    // Traducir el texto del bot√≥n de suscripci√≥n y asegurar que la etiqueta correcta se env√≠e
    const form = document.getElementById('mc-embedded-subscribe-form');
    if (form) {
      const submitButton = document.getElementById('mc-embedded-subscribe');
      if (submitButton && submitButton.value === "Subscribe") {
        submitButton.value = "¬°Quiero mi regalo!";
      }

      // Estilizar el bot√≥n en l√≠nea con nuestro dise√±o
      if (submitButton) {
        submitButton.style.backgroundColor = "#922858";
        submitButton.style.color = "white";
        submitButton.style.borderRadius = "4px";
        submitButton.style.fontSize = "16px";
        submitButton.style.fontWeight = "bold";
        submitButton.style.padding = "10px 20px";
        submitButton.style.width = "100%";
        submitButton.style.marginTop = "15px";
        submitButton.style.cursor = "pointer";
        submitButton.style.transition = "all 0.3s ease";
      }

      // IMPORTANTE: Asegurar que el ID de la etiqueta es correcto (3287077)
      let tagInput = form.querySelector('input[name="tags"]');
      if (!tagInput) {
        const tagDiv = document.createElement('div');
        tagDiv.setAttribute('hidden', '');

        tagInput = document.createElement('input');
        tagInput.type = 'hidden';
        tagInput.name = 'tags';
        tagInput.value = '3287077';

        tagDiv.appendChild(tagInput);
        form.appendChild(tagDiv);
      } else {
        tagInput.value = '3287077';
      }

      // Uso de iframe oculto para enviar el formulario sin redireccionar
      const iframe = document.createElement('iframe');
      iframe.name = 'hidden_submit_iframe';
      iframe.style.display = 'none';
      document.body.appendChild(iframe);

      form.addEventListener('submit', function(event) {
        event.preventDefault();

        const emailInput = document.getElementById('mce-EMAIL');
        if (emailInput && emailInput.value) {
          localStorage.setItem('submittedEmail', emailInput.value);
        }

        if (!form.querySelector('input[name="tags"]') || form.querySelector('input[name="tags"]').value !== '3287077') {
          if (!tagInput) {
            const tagDiv = document.createElement('div');
            tagDiv.setAttribute('hidden', '');

            tagInput = document.createElement('input');
            tagInput.type = 'hidden';
            tagInput.name = 'tags';
            tagInput.value = '3287077';

            tagDiv.appendChild(tagInput);
            form.appendChild(tagDiv);
          } else {
            tagInput.value = '3287077';
          }
        }

        const originalTarget = form.getAttribute('target');
        form.setAttribute('target', 'hidden_submit_iframe');
        form.submit();
        setTimeout(function() {
          form.setAttribute('target', originalTarget || '_blank');
        }, 100);

        setTimeout(function() {
          document.getElementById('popup-step-1').style.display = 'none';
          document.getElementById('popup-step-2').style.display = 'block';
          localStorage.setItem('completedStepTwo', 'true');
          localStorage.setItem('currentStep', '2');
        }, 1000);
      });
    }

    // Cerrar al hacer clic en el bot√≥n Cerrar
    document.getElementById('close-popup').addEventListener('click', function() {
      closePopup(true);
    });

    // Cerrar al hacer clic en la X
    document.querySelector('.close-x').addEventListener('click', function() {
      closePopup(false);
    });

    // Cerrar al hacer clic fuera del popup
    document.getElementById('popup-overlay').addEventListener('click', function() {
      closePopup(false);
    });

    // Reabrir el popup al hacer clic en la versi√≥n minimizada
    document.getElementById('minimized-popup').addEventListener('click', function() {
      document.getElementById('minimized-popup').style.display = 'none';
      document.getElementById('popup-container').style.display = 'block';
      document.getElementById('popup-overlay').style.display = 'block';

      // Si ya estaba en el paso 2, mostramos el paso 2
      if (localStorage.getItem('currentStep') === '2') {
        document.getElementById('popup-step-1').style.display = 'none';
        document.getElementById('popup-step-2').style.display = 'block';
      } else {
        document.getElementById('popup-step-1').style.display = 'block';
        document.getElementById('popup-step-2').style.display = 'none';
      }
    });

    // Funci√≥n para cerrar el popup
    function closePopup(completed) {
      document.getElementById('popup-container').style.display = 'none';
      document.getElementById('popup-overlay').style.display = 'none';

      // Si complet√≥ el paso 2, marcar como completado
      if (completed) {
        localStorage.setItem('completedStepTwo', 'true');
      } else {
        // Si no complet√≥, guardamos el paso actual para cuando vuelva
        const currentStep = document.getElementById('popup-step-1').style.display === 'none' ? '2' : '1';
        localStorage.setItem('currentStep', currentStep);

        // Mostrar la versi√≥n minimizada si no ha completado el paso 2
        if (!completedStepTwo) {
          minimizedPopup.style.display = 'flex';
        }
      }
    }

    // Configuraci√≥n del cron√≥metro de 3 horas
    var countdownTime = 3 * 60 * 60; // 3 horas en segundos
    var countdownElement = document.getElementById('countdown-timer');

    function updateCountdown() {
      var hours = Math.floor(countdownTime / 3600);
      var minutes = Math.floor((countdownTime % 3600) / 60);
      var seconds = countdownTime % 60;

      countdownElement.textContent = 'Oferta v√°lida por: ' + hours.toString().padStart(2, '0') + ':' + minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');

      if (countdownTime > 0) {
        countdownTime--;
        setTimeout(updateCountdown, 1000);
      } else {
        countdownElement.textContent = 'La oferta ha expirado.';
      }
    }

    updateCountdown();
  });
</script>
